<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ECharts 图表框选功能</title>
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        margin: 0 auto;
      }
      #main {
        width: 900px;
        height: 600px;
        margin: 30px auto;
      }
      @media screen and (max-width: 900px) {
        #main {
          width: 100%;
          height: 600px;
        }
      }
      @media screen and (max-width: 600px) {
        #main {
          width: 100%;
          height: 400px;
        }
      }
    </style>
  </head>
  <body>
    <!-- 主页面 -->
    <div id="main"></div>
    <!-- jquery 库 -->
    <script src="../libs/js/jquery@3.6.4.min.js"></script>
    <!-- echarts 库 -->
    <script src="../libs/js/echarts@5.4.3.min.js"></script>
    <script src="../libs/js/autofit.js"></script>
    <script>
      var option = {
        backgroundColor: "#fff",
        title: {
          text: "温度曲线",
          subtext: "时间(2024-02-08 00:00:10 - 2024-02-08 23:59:59)",
          right: "center",
          textStyle: { color: "#000", fontSize: 16, fontWeight: "900" },
          subtextStyle: { color: "#000", fontSize: 14 },
        },
        color: ["blue", "orange", "red"],
        tooltip: {
          trigger: "axis",
          axisPointer: {
            type: "cross",
            crossStyle: { color: "#999" },
            lineStyle: { type: "dashed" },
          },
        },
        toolbox: {
          feature: {
            saveAsImage: {}, // 导出图片
            dataView: { readOnly: false }, // 数据视图
            magicType: { type: ["line", "bar"] }, // 动态类型切换
            dataZoom: {}, // 数据区域缩放
            restore: {}, // 重置
          },
        },
        brush: {
          throttleType: "debounce",
          throttleDelay: 500,
          xAxisIndex: "all",
          toolbox: ["rect", "clear"],
          outOfBrush: {
            colorAlpha: 1,
          },
          inBrush: {
            colorAlpha: 0.3,
          },
        },
        grid: {
          left: "60",
          right: "60",
          bottom: "60",
          top: "100",
          containLabel: true,
        },
        xAxis: {
          type: "category",
          data: [
            "2024-02-08 00:00:10",
            "2024-02-08 00:10:10",
            "2024-02-08 00:20:10",
            "2024-02-08 00:30:10",
            "2024-02-08 00:40:10",
            "2024-02-08 00:50:10",
            "2024-02-08 01:00:08",
            "2024-02-08 01:10:10",
            "2024-02-08 01:20:10",
            "2024-02-08 01:30:10",
            "2024-02-08 01:40:09",
            "2024-02-08 01:50:10",
            "2024-02-08 02:00:10",
            "2024-02-08 02:10:10",
            "2024-02-08 02:20:09",
            "2024-02-08 02:30:11",
            "2024-02-08 02:40:09",
            "2024-02-08 02:50:10",
            "2024-02-08 03:00:09",
            "2024-02-08 03:10:11",
            "2024-02-08 03:20:09",
            "2024-02-08 03:30:10",
            "2024-02-08 03:40:10",
            "2024-02-08 03:50:09",
            "2024-02-08 04:00:09",
            "2024-02-08 04:10:09",
            "2024-02-08 04:20:12",
            "2024-02-08 04:30:09",
            "2024-02-08 04:40:09",
            "2024-02-08 04:50:11",
            "2024-02-08 05:00:10",
            "2024-02-08 05:10:10",
            "2024-02-08 05:20:08",
            "2024-02-08 05:30:11",
            "2024-02-08 05:40:10",
            "2024-02-08 05:50:10",
            "2024-02-08 06:00:10",
            "2024-02-08 06:10:09",
            "2024-02-08 06:20:10",
            "2024-02-08 06:30:10",
            "2024-02-08 06:40:10",
            "2024-02-08 06:50:09",
            "2024-02-08 07:00:10",
            "2024-02-08 07:10:10",
            "2024-02-08 07:20:10",
            "2024-02-08 07:30:10",
            "2024-02-08 07:40:09",
            "2024-02-08 07:50:10",
            "2024-02-08 08:00:10",
            "2024-02-08 08:10:10",
            "2024-02-08 08:20:09",
            "2024-02-08 08:30:10",
            "2024-02-08 08:40:10",
            "2024-02-08 08:50:10",
            "2024-02-08 09:00:09",
            "2024-02-08 09:10:10",
            "2024-02-08 09:20:10",
            "2024-02-08 09:30:09",
            "2024-02-08 09:40:10",
            "2024-02-08 09:50:10",
            "2024-02-08 10:00:10",
            "2024-02-08 10:10:09",
            "2024-02-08 10:20:11",
            "2024-02-08 10:30:09",
            "2024-02-08 10:40:10",
            "2024-02-08 10:50:10",
            "2024-02-08 11:00:10",
            "2024-02-08 11:10:09",
            "2024-02-08 11:20:10",
            "2024-02-08 11:30:10",
            "2024-02-08 11:40:10",
            "2024-02-08 11:50:10",
            "2024-02-08 12:00:09",
            "2024-02-08 12:10:10",
            "2024-02-08 12:20:10",
            "2024-02-08 12:30:10",
            "2024-02-08 12:40:09",
            "2024-02-08 12:50:10",
            "2024-02-08 13:00:10",
            "2024-02-08 13:10:10",
            "2024-02-08 13:20:10",
            "2024-02-08 13:30:09",
            "2024-02-08 13:40:10",
            "2024-02-08 13:50:10",
            "2024-02-08 14:00:10",
            "2024-02-08 14:10:09",
            "2024-02-08 15:00:51",
            "2024-02-08 15:01:48",
            "2024-02-08 15:48:27",
            "2024-02-08 15:49:26",
            "2024-02-08 15:50:10",
            "2024-02-08 16:00:09",
            "2024-02-08 16:10:10",
            "2024-02-08 16:20:10",
            "2024-02-08 16:30:10",
            "2024-02-08 16:40:10",
            "2024-02-08 16:50:09",
            "2024-02-08 17:00:10",
            "2024-02-08 17:10:10",
            "2024-02-08 17:20:10",
            "2024-02-08 17:30:09",
            "2024-02-08 17:40:10",
            "2024-02-08 17:50:10",
            "2024-02-08 18:00:09",
            "2024-02-08 18:10:10",
            "2024-02-08 18:20:10",
            "2024-02-08 18:30:10",
            "2024-02-08 18:40:10",
            "2024-02-08 18:50:09",
            "2024-02-08 19:00:09",
            "2024-02-08 19:10:09",
            "2024-02-08 19:20:12",
            "2024-02-08 19:30:09",
            "2024-02-08 19:40:10",
            "2024-02-08 19:50:10",
            "2024-02-08 20:00:10",
            "2024-02-08 20:10:08",
            "2024-02-08 20:20:11",
            "2024-02-08 20:30:10",
            "2024-02-08 20:40:10",
            "2024-02-08 20:50:10",
            "2024-02-08 21:00:10",
            "2024-02-08 21:10:09",
            "2024-02-08 21:20:10",
            "2024-02-08 21:30:10",
            "2024-02-08 21:40:10",
            "2024-02-08 21:50:10",
            "2024-02-08 22:00:09",
            "2024-02-08 22:10:10",
            "2024-02-08 22:20:10",
            "2024-02-08 22:30:09",
            "2024-02-08 22:40:10",
            "2024-02-08 22:50:10",
            "2024-02-08 23:00:10",
            "2024-02-08 23:10:10",
            "2024-02-08 23:20:10",
            "2024-02-08 23:30:09",
            "2024-02-08 23:40:10",
            "2024-02-08 23:50:10",
          ],
          axisLabel: { showMaxLabel: true, color: "#000", margin: 50 },
          splitLine: { show: false },
          axisTick: { show: false },
          axisLine: { show: false },
        },
        yAxis: {
          type: "value",
          name: "温度(°C)",
          nameLocation: "center",
          nameGap: 60,
          nameTextStyle: { color: "#000", fontSize: 13 },
          axisLabel: { color: "#000", textStyle: { fontSize: 12 }, margin: 20 },
          splitLine: { lineStyle: { color: "#F3F4F4" } },
          min: 0,
          max: 12.6,
        },
        dataZoom: [
          // { type: "inside", xAxisIndex: [0], start: 0, end: 100 },
          { type: "inside", xAxisIndex: [0], start: 0, end: 100 },
          { type: "inside", yAxisIndex: [0], start: 0, end: 100 },
        ],
        series: {
          name: "温度(°C)",
          type: "line",
          smooth: true,
          data: [
            4.1, 5.2, 6.3, 4, 4.7, 5.8, 5.7, 4.2, 5.3, 6.2, 3.9, 2.8, 1.9, 1,
            0.3, 0.9, 3.4, 3.9, 4.7, 5.9, 5.1, 4.4, 5.3, 6.4, 4, 5, 6.1, 4.5,
            4.4, 5.5, 6.3, 4, 5.1, 6.1, 4, 4.5, 5.5, 6, 4.2, 5.1, 6.2, 4.1, 4.6,
            5.7, 5.9, 4.2, 5.3, 6, 5.1, 4.8, 4.7, 4.7, 4.9, 5.9, 5.8, 5, 5, 5,
            5.1, 5.3, 5.4, 5.5, 6.2, 6.3, 5.6, 5.4, 5.4, 5.5, 5.6, 5.7, 5.9,
            5.9, 5.9, 6, 6.1, 6.2, 6.4, 7.2, 7.1, 7.1, 7.4, 8, 8.9, 9.7, 10.5,
            11.2, 12.5, 12.6, 9.4, 9.4, 9.2, 4.4, 5, 6.2, 4, 4.7, 5.9, 4.6, 4.4,
            5.6, 6.1, 3.9, 5.1, 6.3, 3.9, 4.7, 5.9, 4.8, 4.3, 5.6, 6.2, 4, 5.1,
            6.2, 3.9, 4.8, 5.9, 4.5, 4.3, 5.5, 6.3, 4, 5.2, 6.3, 3.9, 4.8, 5.8,
            5, 4.2, 5.5, 6.4, 3.8, 4.9, 6.1, 4.1, 4.5, 5.6, 5.6, 4.3,
          ],
          showSymbol: false,
          markPoint: {
            symbol: "pin",
            itemStyle: { opacity: 1 },
            data: [
              {
                type: "max",
                name: "最高温",
                symbolSize: 60,
                label: {
                  show: true,
                  offset: [0, -1],
                  color: "#fff",
                  formatter: "{b}\n{c}",
                  fontSize: 11,
                  fontWeight: 700,
                },
              },
              {
                type: "min",
                name: "最低温",
                symbolRotate: 180,
                symbolSize: 60,
                symbolOffset: [0, 1],
                label: {
                  show: true,
                  offset: [0, 12],
                  color: "#fff",
                  formatter: "{c}\n{b}",
                  fontSize: 11,
                  fontWeight: 700,
                },
              },
            ],
          },
          markLine: {
            data: [
              {
                name: 1,
                yAxis: 1,
                lineStyle: { color: "orange" },
                label: { formatter: "{b}", position: "end" },
              },
              {
                name: 9,
                yAxis: 9,
                lineStyle: { color: "red" },
                label: { formatter: "{b}", position: "end" },
              },
            ],
            label: { distance: [20, 8] },
          },
        },
        visualMap: {
          show: false,
          dimension: 1,
          pieces: [
            { lte: 1, color: "orange" },
            { gte: 1, lte: 9, color: "blue" },
            { gte: 9, color: "red" },
          ],
        },
      };
    </script>
    <!-- js -->
    <script>
      // autofit.init({
      //   designWidth: 1920,
      //   designHeight: 1080,
      //   renderDom: "#main",
      //   resize: true,
      // });
      // 基于准备好的dom，初始化echarts实例
      var myChart = echarts.init(document.getElementById("main"));
      // 使用刚指定的配置项和数据显示图表。
      myChart.setOption(option);
      // 缩放时触发函数
      myChart.on("dataZoom", function (params) {
        console.log("dataZoom：", params);
      });
      myChart.on("brushSelected", function (params) {
        console.log("brushSelected：", params);
      });
      myChart.on("brushEnd", function (params) {
        console.log("brushEnd：", params);
        // 判断是否有框选区域
        if (params.areas.length === 0) {
          return;
        }
        console.log(params);
        // 根据 coordRange 计算框选区域内的x坐标的startValue和endValue，然后根据startValue和endValue进行放大曲线点位
        const xAxisRange = params.areas[0].coordRange[0];
        const yAxisRange = params.areas[0].coordRange[1];
        const xstartValue = xAxisRange[0]; //x 轴 startValue
        const xendValue = xAxisRange[1]; //x 轴 endValue
        const ystartValue = yAxisRange[0]; //y轴 startValue
        const yendValue = yAxisRange[1]; //y轴 endValue

        console.log("x轴：", xstartValue, xendValue);
        console.log("y轴：", ystartValue, yendValue);

        // myChart.setOption({
        //   dataZoom: [
        //     {
        //       xAxisIndex: [0],
        //       startValue: xstartValue,
        //       endValue: xendValue,
        //     },
        //     {
        //       yAxisIndex: [0],
        //       startValue: ystartValue,
        //       endValue: yendValue,
        //     },
        //   ],
        // });

        myChart.dispatchAction({
          type: "dataZoom",
          batch: [
            {
              // 第一个 dataZoom 组件
              startValue: xstartValue,
              endValue: xendValue,
            },
            {
              // 第二个 dataZoom 组件
              startValue: ystartValue,
              endValue: yendValue,
            },
          ],
        });
        // 如果 areas 为空，则删除所有选框。否则，曲线图上则会存在选框区域未清除
        myChart.dispatchAction({
          type: "brush",
          areas: [],
        });
      });
    </script>
  </body>
</html>
